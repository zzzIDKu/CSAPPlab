# Datalab-69

## absVal*

- 获取x的绝对值

- 示例: absVal(-1) = 1

- 说明：-TMax <= x <= TMAX
- 限制操作: ! ~ & ^ | + << >>
- 操作数量: 10
- 难度: 4

$$
x=\begin{cases}
  \ \ \thicksim x+1,& \text{ if  x<0}\\
  \ \ x,&\text{  if x>0}
\end{cases}
$$

可知
$$
X_n>>(n-1)=\begin{cases}
&1111...1111&\text{x<0}\\
&0000...0000&\text{x>0}
\end{cases}
$$

### 解法1

因此可用负数可用移位后的与变正数后的取交。正确可用移位的按位取反再取与。两张取或。

即

~~~c
long absVal(long x){
    return ((x>>63)&(~x+1))((~(x>>63)&x));
}
~~~

### 解法2

对X处理为负数**取反+1**,**正数不变**

一个数取反可以异或1，不变可以异或0。

可用移位后的与原数异或即为对应的反码，在用移位的与1判判定是否需要加1。

~~~c
long absVal(long x){
    return ((x>>63)^x)+((x>>63)&1);
}
~~~

##  addOK

- 判断x+y是否溢出，溢出返回0，反之
- 示例：addOK(0x8000000,0x8000000) = 0
- 限制操作：! ~ & ^ | + << >>
- 操作数量：20
- 难度：3

只有正数相加和负数相加可能溢出。

正数判断符号位是否变为1，负数判断是否变为0。

即判断是否与原来相同。

~~~c
long addOK(long x,long y){
    return (((x^y)>>63)|(~(x^(x+y)>>63)))&1;
}
~~~

